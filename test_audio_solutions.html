<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Audio Solutions - Sistem Antrian</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #005a87; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .solution-box { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #28a745; }
        .test-button { background: #28a745; }
        .test-button:hover { background: #218838; }
        .fallback-button { background: #ffc107; color: #000; }
        .fallback-button:hover { background: #e0a800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Audio Solutions - Sistem Antrian</h1>
        <p class="info">Test semua solusi audio yang telah diimplementasikan</p>
        
        <div class="solution-box">
            <h3>üì¢ Format Audio Announcement</h3>
            <p><strong>Template:</strong> "Nomor antrian [NOMOR], layanan [LAYANAN], menuju ke loket [LOKET], ZONA [ZONA]. Terima kasih."</p>
            <p><strong>Contoh:</strong> "Nomor antrian 1A05, layanan Pengambilan Izin, menuju ke loket ZONA 1, ZONA UPTSP. Terima kasih."</p>
        </div>
        
        <div class="test-section">
            <h3>1. Test All Audio Solutions (Automatic Fallback)</h3>
            <button onclick="testAllSolutions()" class="test-button">üéµ Test All Solutions</button>
            <div id="all-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>2. Test Individual Solutions</h3>
            <button onclick="testResponsiveVoice()" class="test-button">üîä Test ResponsiveVoice</button>
            <button onclick="testSpeechSynthesis()" class="fallback-button">üó£Ô∏è Test Speech Synthesis</button>
            <button onclick="testAudioFile()" class="fallback-button">üéµ Test Audio File</button>
            <button onclick="testBeepSound()" class="fallback-button">üîî Test Beep Sound</button>
            <div id="individual-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>3. Test Queue Announcements</h3>
            <button onclick="testQueueAnnouncement()" class="test-button">üì¢ Test Queue Announcement</button>
            <button onclick="testMultipleQueues()" class="test-button">üîÑ Test Multiple Queues</button>
            <div id="queue-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>4. Browser Compatibility</h3>
            <button onclick="checkCompatibility()" class="test-button">üîç Check Compatibility</button>
            <div id="compatibility-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>5. System Status</h3>
            <div id="status-log" class="log"></div>
        </div>
    </div>

    <script>
        // Audio enabled flag
        let audioEnabled = false;
        
        // Enable audio function
        const enableAudio = () => {
            if (!audioEnabled) {
                console.log("Enabling audio on user interaction...");
                audioEnabled = true;
                
                // Test ResponsiveVoice
                if (typeof responsiveVoice !== "undefined") {
                    responsiveVoice.speak("Audio enabled", "Indonesian Female", {
                        rate: 0.8,
                        volume: 0.3
                    });
                }
            }
        };
        
        // Logging function
        function log(message, type = "info", section = "status") {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById(section + "-log");
            const className = type === "success" ? "success" : type === "error" ? "error" : type === "warning" ? "warning" : "info";
            logElement.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // Test all solutions (same as dashboard implementation)
        function testAllSolutions() {
            log("Testing all audio solutions with automatic fallback...", "info", "all");
            enableAudio();
            
            const announcementText = "Nomor antrian 1A05, layanan Pengambilan Izin, menuju ke loket ZONA 1, ZONA UPTSP. Terima kasih.";
            
            tryAudioSolutions(announcementText);
        }
        
        function tryAudioSolutions(announcementText) {
            log("=== TRYING AUDIO SOLUTIONS ===", "info", "all");
            
            // Solution 1: Try ResponsiveVoice
            if (typeof responsiveVoice !== "undefined") {
                log("Trying ResponsiveVoice...", "info", "all");
                try {
                    responsiveVoice.speak(announcementText, "Indonesian Female", {
                        rate: 0.8,
                        pitch: 1,
                        volume: 1,
                        onstart: function() {
                            log("‚úÖ ResponsiveVoice started successfully", "success", "all");
                        },
                        onend: function() {
                            log("‚úÖ ResponsiveVoice completed successfully", "success", "all");
                        },
                        onerror: function(error) {
                            log("‚ùå ResponsiveVoice failed: " + error, "error", "all");
                            trySpeechSynthesis(announcementText);
                        }
                    });
                    return;
                } catch (error) {
                    log("‚ùå ResponsiveVoice error: " + error, "error", "all");
                }
            } else {
                log("‚ùå ResponsiveVoice not available", "error", "all");
            }
            
            trySpeechSynthesis(announcementText);
        }
        
        function trySpeechSynthesis(announcementText) {
            log("Trying Speech Synthesis...", "info", "all");
            
            if ("speechSynthesis" in window) {
                try {
                    const utterance = new SpeechSynthesisUtterance(announcementText);
                    utterance.lang = "id-ID";
                    utterance.rate = 0.8;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    
                    utterance.onstart = function() {
                        log("‚úÖ Speech Synthesis started successfully", "success", "all");
                    };
                    
                    utterance.onend = function() {
                        log("‚úÖ Speech Synthesis completed successfully", "success", "all");
                    };
                    
                    utterance.onerror = function(error) {
                        log("‚ùå Speech Synthesis failed: " + error.error, "error", "all");
                        tryAudioFile();
                    };
                    
                    speechSynthesis.speak(utterance);
                    return;
                } catch (error) {
                    log("‚ùå Speech Synthesis error: " + error, "error", "all");
                }
            } else {
                log("‚ùå Speech Synthesis not available", "error", "all");
            }
            
            tryAudioFile();
        }
        
        function tryAudioFile() {
            log("Trying Audio File...", "info", "all");
            
            try {
                const audio = new Audio("/sounds/opening.mp3");
                audio.volume = 0.8;
                
                audio.oncanplaythrough = function() {
                    log("‚úÖ Audio file can play", "success", "all");
                    audio.play().then(function() {
                        log("‚úÖ Audio file playing successfully", "success", "all");
                    }).catch(function(error) {
                        log("‚ùå Audio file play failed: " + error.message, "error", "all");
                        tryBeepSound();
                    });
                };
                
                audio.onerror = function(error) {
                    log("‚ùå Audio file error: " + error.message, "error", "all");
                    tryBeepSound();
                };
                
                audio.load();
            } catch (error) {
                log("‚ùå Audio file error: " + error.message, "error", "all");
                tryBeepSound();
            }
        }
        
        function tryBeepSound() {
            log("Trying Beep Sound...", "info", "all");
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                log("‚úÖ Beep sound played successfully", "success", "all");
            } catch (error) {
                log("‚ùå Beep sound failed: " + error.message, "error", "all");
                log("‚ùå All audio solutions failed", "error", "all");
            }
        }
        
        // Individual solution tests
        function testResponsiveVoice() {
            log("Testing ResponsiveVoice individually...", "info", "individual");
            enableAudio();
            
            if (typeof responsiveVoice !== "undefined") {
                responsiveVoice.speak("Test ResponsiveVoice", "Indonesian Female", {
                    rate: 0.8,
                    onstart: () => log("ResponsiveVoice started", "success", "individual"),
                    onend: () => log("ResponsiveVoice completed", "success", "individual"),
                    onerror: (error) => log("ResponsiveVoice error: " + error, "error", "individual")
                });
            } else {
                log("ResponsiveVoice not available", "error", "individual");
            }
        }
        
        function testSpeechSynthesis() {
            log("Testing Speech Synthesis individually...", "info", "individual");
            enableAudio();
            
            if ("speechSynthesis" in window) {
                const utterance = new SpeechSynthesisUtterance("Test Speech Synthesis");
                utterance.lang = "id-ID";
                utterance.rate = 0.8;
                
                utterance.onstart = () => log("Speech Synthesis started", "success", "individual");
                utterance.onend = () => log("Speech Synthesis completed", "success", "individual");
                utterance.onerror = (error) => log("Speech Synthesis error: " + error.error, "error", "individual");
                
                speechSynthesis.speak(utterance);
            } else {
                log("Speech Synthesis not available", "error", "individual");
            }
        }
        
        function testAudioFile() {
            log("Testing Audio File individually...", "info", "individual");
            enableAudio();
            
            try {
                const audio = new Audio("/sounds/opening.mp3");
                audio.oncanplaythrough = () => {
                    log("Audio file can play", "success", "individual");
                    audio.play().then(() => {
                        log("Audio file playing", "success", "individual");
                    }).catch(error => {
                        log("Audio file play error: " + error.message, "error", "individual");
                    });
                };
                audio.onerror = (error) => {
                    log("Audio file error: " + error.message, "error", "individual");
                };
                audio.load();
            } catch (error) {
                log("Audio file test error: " + error.message, "error", "individual");
            }
        }
        
        function testBeepSound() {
            log("Testing Beep Sound individually...", "info", "individual");
            enableAudio();
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                log("Beep sound played", "success", "individual");
            } catch (error) {
                log("Beep sound error: " + error.message, "error", "individual");
            }
        }
        
        // Queue announcement tests
        function testQueueAnnouncement() {
            log("Testing queue announcement...", "info", "queue");
            enableAudio();
            
            const announcementText = "Nomor antrian 1A05, layanan Pengambilan Izin, menuju ke loket ZONA 1, ZONA UPTSP. Terima kasih.";
            tryAudioSolutions(announcementText);
        }
        
        function testMultipleQueues() {
            log("Testing multiple queue announcements...", "info", "queue");
            enableAudio();
            
            const queues = [
                "Nomor antrian 1A05, layanan Pengambilan Izin, menuju ke loket ZONA 1, ZONA UPTSP. Terima kasih.",
                "Nomor antrian 1B03, layanan Konsultasi PTSP, menuju ke loket ZONA 1, ZONA UPTSP. Terima kasih.",
                "Nomor antrian 2A01, layanan Layanan SKCK, menuju ke loket ZONA 2, ZONA UPTSP. Terima kasih."
            ];
            
            let currentIndex = 0;
            
            function announceNext() {
                if (currentIndex < queues.length) {
                    log(`Announcing queue ${currentIndex + 1}/${queues.length}`, "info", "queue");
                    tryAudioSolutions(queues[currentIndex]);
                    currentIndex++;
                    if (currentIndex < queues.length) {
                        setTimeout(announceNext, 3000);
                    }
                }
            }
            
            announceNext();
        }
        
        // Compatibility check
        function checkCompatibility() {
            log("Checking browser compatibility...", "info", "compatibility");
            
            const userAgent = navigator.userAgent;
            log("User Agent: " + userAgent, "info", "compatibility");
            
            if (userAgent.includes("Chrome")) {
                log("‚úÖ Chrome browser detected", "success", "compatibility");
            } else if (userAgent.includes("Firefox")) {
                log("‚úÖ Firefox browser detected", "success", "compatibility");
            } else if (userAgent.includes("Safari")) {
                log("‚úÖ Safari browser detected", "success", "compatibility");
            } else if (userAgent.includes("Edge")) {
                log("‚úÖ Edge browser detected", "success", "compatibility");
            } else {
                log("‚ö†Ô∏è Unknown browser detected", "warning", "compatibility");
            }
            
            if (location.protocol === "https:") {
                log("‚úÖ HTTPS connection", "success", "compatibility");
            } else {
                log("‚ö†Ô∏è HTTP connection (audio may not work)", "warning", "compatibility");
            }
            
            if (typeof responsiveVoice !== "undefined") {
                log("‚úÖ ResponsiveVoice loaded", "success", "compatibility");
            } else {
                log("‚ùå ResponsiveVoice not loaded", "error", "compatibility");
            }
            
            if ("speechSynthesis" in window) {
                log("‚úÖ Speech Synthesis supported", "success", "compatibility");
            } else {
                log("‚ùå Speech Synthesis not supported", "error", "compatibility");
            }
            
            if (typeof Audio !== "undefined") {
                log("‚úÖ Audio API supported", "success", "compatibility");
            } else {
                log("‚ùå Audio API not supported", "error", "compatibility");
            }
        }
        
        // Initialize
        window.onload = function() {
            log("Audio Solutions Test Page Loaded", "success", "status");
            log("", "info", "status");
            log("=== AUDIO SOLUTIONS IMPLEMENTED ===", "info", "status");
            log("", "info", "status");
            log("1. ResponsiveVoice (Primary)", "info", "status");
            log("   - Indonesian Female voice", "info", "status");
            log("   - Rate: 0.8, Pitch: 1, Volume: 1", "info", "status");
            log("", "info", "status");
            log("2. Speech Synthesis (Fallback 1)", "info", "status");
            log("   - Browser native TTS", "info", "status");
            log("   - Indonesian language support", "info", "status");
            log("", "info", "status");
            log("3. Audio File (Fallback 2)", "info", "status");
            log("   - /sounds/opening.mp3", "info", "status");
            log("   - Web Audio API", "info", "status");
            log("", "info", "status");
            log("4. Beep Sound (Fallback 3)", "info", "status");
            log("   - Web Audio API oscillator", "info", "status");
            log("   - 800Hz-600Hz-800Hz pattern", "info", "status");
            log("", "info", "status");
            log("Format: Nomor antrian [NOMOR], layanan [LAYANAN], menuju ke loket [LOKET], ZONA [ZONA]. Terima kasih.", "info", "status");
        };
    </script>
</body>
</html>